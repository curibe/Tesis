import numpy as np
import os
import commands as cm
from Jupiter import *
from ParamConf import *


#==============
# SHORCUTS
#==============
system=os.system
get=cm.getoutput
getdir=os.getcwd
chdir=os.chdir

#==============
# PATHS
#==============
HOME=get("echo $HOME")
InitDir=HOME+"/Projects/Tesis/Cond_Iniciales"
Principal=HOME+'/Projects/Tesis'
Actual=Principal+"/BIN"
RunDir=Principal+"/RUNDIR"

#===========================
# CREATING RUNS DIRECTORIES
#===========================
cmd='wc '+InitDir+'/Io.pos | cut -f 4 -d \" \"' 
NDIR=int(get(cmd))
chdir(Principal)
system("bash DirBuild.sh %d"%NDIR)
chdir(Actual)


#================================
# CREATING CONFIGURATION FILES
#================================

#cmd="ls "+InitDir+"/*.pos"
#filesPos=get(cmd)
#N=len(filePos)



# OPEN STATE FILES FOR EACH BODY
#--------------------------------------
nbod=len(Bodyin)
States=np.zeros([nbod+1,NDIR,6])
Xio=np.loadtxt(InitDir+"/Io.pos",usecols=(i for i in range(1,7)))
for k in range(nbod):
    path=InitDir+"/"+Bodyin[k]
    X=np.loadtxt(path,usecols=(i for i in range(1,7)))
    States[k]=X
    
#Xio=np.loadtxt(InitDir+"/Io.pos",usecols=(i for i in range(1,7)))
#Xeuropa=np.loadtxt(InitDir+"/Europa.pos",usecols=(i for i in range(1,7)))
#Xganymede=np.loadtxt(InitDir+"/Ganymede.pos",usecols=(i for i in range(1,7)))
#Xcalixto=np.loadtxt(InitDir+"/Calixto.pos",usecols=(i for i in range(1,7)))
#Xsun=np.loadtxt(InitDir+"/Sun.pos",usecols=(i for i in range(1,7)))
et=np.loadtxt(InitDir+"/JupiterPos.dat",usecols=[1])


Bodies=[IO,EUROPA,GANYMEDE,CALIXTO,SUN]
#States=[Xio,Xeuropa,Xganymede,Xcalixto,Xsun]

for i in range(NDIR):
    #system("echo Cleaning system.config file:; rm system.config")
    ofile=open("system.config","a")    

    HeadConfig(Time,i+1,ofile)
    CentralBody(JUPITER,ofile)
    
    for cuerpo in range(len(Bodies)):
        BodyConfig(Bodies[cuerpo],States[cuerpo][i],cuerpo+1,ofile)

    TailConfig(ofile)
    ofile.close()

    # MOVING THE CONFIGURATION FILE TO THE CORRESPONDING RUN DIR
    cmd="mv system.config " + RunDir + "/run%d/"%(i+1)
    #print cmd
    system(cmd)
